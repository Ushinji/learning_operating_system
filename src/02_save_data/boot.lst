     1                                  ; **********************************************
     2                                  ; save_data
     3                                  ; ブートプログラム内でデータを保存するための設定を行う
     4                                  ; **********************************************
     5                                  
     6                                          ; equ: C言語の#defineと同じ。アセンブル時に、指定の定数を指定した値に置き換えてくれる
     7                                          ; equ = Equal(だと思われる)
     8                                          BOOT_LOAD       equ     0x7C00  ;ブートプログラムのロード位置
     9                                  
    10                                          ; ロードアドレスをアセンブラに指示.ORG=origin.
    11                                          ; ORGディレクティブにより、アセンブラが出力するアドレスにはBOOT_LOADの値が加算されるため、BPBへの意図しない書き込みを防ぐ。
    12                                          ORG     BOOT_LOAD
    13                                  
    14                                  entry:
    15 00000000 EB58                            jmp     ipl
    16 00000002 90<rept>                        times 90 - ($ - $$) db 0x90
    17                                  ipl:
    18                                          ; BIOSからの割り込みを禁止
    19 0000005A FA                              cli
    20                                  
    21                                          ; 割り込み禁止中に行う初期化処理
    22 0000005B B80000                          mov     ax, 0x0000      ; Accumulate(蓄積) Register = 0x0000
    23                                          ; セグメントレジスタに対して直接に値を代入することはできないので、AXレジスタ経由で行う
    24 0000005E 8ED8                            mov     ds, ax          ; Data Segment  = 0x0000
    25 00000060 8EC0                            mov     es, ax          ; Extra Segment = 0x0000
    26 00000062 8ED0                            mov     ss, ax          ; Stack Segment = 0x0000
    27 00000064 BC007C                          mov     sp, BOOT_LOAD   ; Stack Point   = 0x7C00
    28                                  
    29                                          ; 割り込み許可
    30 00000067 FB                              sti
    31                                  
    32                                          ;ブートドライブを保存
    33 00000068 8816[6E00]                      mov     [BOOT.DRIVE], dl
    34                                  
    35 0000006C EBFE                            jmp     $
    36                                  
    37                                  ; ALIGNディレクティブ。データを2バイト境界で配置するように指示
    38                                  ALIGN 2, db 0
    39                                  
    40                                  ; ブートドライブに関する情報
    41                                  BOOT:
    42 0000006E 0000                    .DRIVE:         dw 0    ; ドライブ番号
    43                                  
    44 00000070 00<rept>                        times 510 - ($ - $$) db 0x00
    45 000001FE 55AA                            db 0x55, 0xAA
